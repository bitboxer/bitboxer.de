<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Bitboxer - Check MySQL Master-Slave replication</title>
    <meta name="viewport" content="width=device-width">

    <link href="/atom.xml" rel="alternate" title="Bitboxer" type="application/atom+xml">

    <script src="https://kit.fontawesome.com/e39a1d799d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <script src="/js/index.js"></script>

    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
      (function(f, a, t, h, o, m) {
        a[h] =
          a[h] ||
          function() {
            (a[h].q = a[h].q || []).push(arguments);
          };
        (o = f.createElement("script")),
          (m = f.getElementsByTagName("script")[0]);
        o.async = 1;
        o.src = t;
        o.id = "fathom-script";
        m.parentNode.insertBefore(o, m);
      })(document, window, "//ping.bitboxer.de/tracker.js", "fathom");
      fathom("set", "siteId", "WMQSI");
      fathom("trackPageview");
    </script>
    <!-- / Fathom -->
  </head>
  <body>
    <div class="container">
      <div class="site">
        <div class="header">
          <h1 class="header--title"><a href="https://bodo.tasche.me">Bitboxer</a></h1>
          <div class="header--menu">
            <a class="extra" href="https://bitboxer.de">blog</a>
            <a class="extra" href="https://bodo.tasche.me/projects">projects</a>
            <a class="extra" href="https://bodo.tasche.me">aboutÂ me</a>
          </div>
        </div>

        <div class="content">
  <article>
    
    <div class="head-without-image">
      <h1 class="headline">Check MySQL Master-Slave replication</h1>
      <time datetime="2010-08-18T23:31:06.000+0200">18 Aug 2010</time>
    </div>
    

    <div class="post">
      <p>A lot of <a href="http://railslab.newrelic.com/scaling-rails">guides</a> explain that you
can use MySQL master-slave replication to scale your database performance. But
nobody explains how to keep the database instances in synch. MySQL replications
are very shaky and tend to break and mess up stuff very easily. From my
standpoint the whole replication scheme looks like a smart hack into the MySQL
system.</p>

<p>Till today I used some self written scripts to check our systems. Nobody told
me that there was a perfect toolchain for this problem already existing:
<a href="http://www.maatkit.org/">Maatkit</a>. Maatkit offers a few commandline tools that
help you to keep the slaves in synch with your master.</p>

<p>Install it using brew:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install maatkit
</code></pre></div></div>

<p>Check tables for differences :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mk-table-checksum h=HOSTMASTER,u=USERMASTER,p=PASSWORDMASTER h=HOSTSLAVE,u=USERSLAVE,p=PASSWORDSLAVE -d DATABASE | mk-checksum-filter
</code></pre></div></div>

<p>And after you found differences you can even use Maatkit to repair those tables:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mk-table-sync --execute --sync-to-master h=SLAVEIP,u=USER,p=PASSWORD,D=DATABASE,t=TABLE
</code></pre></div></div>

<p>Besides repairing damaged tables Maatkit helps you to check if the slave
replication is still working.
<a href="http://www.maatkit.org/doc/mk-heartbeat.html">Mk-heartbeat</a> updates a
heartbeat table in the master database and checks if the slave database has
been updated. I have written a small script that wraps the heartbeat check and
sends a mail if the slave replication has stopped.</p>

<p>More documentation can be found <a href="http://www.maatkit.org/doc/">here</a> and a few
examples in <a href="http://www.scribd.com/doc/15014708/Make-Your-Life-Easier-with-Maatkit">this presentation</a>.</p>

<p>And yes, using couchdb would make this toolchain obsolete :smile: .</p>

    </div>
  </article>
</div>
<div class="author">
  <div class="author--photo">
    <img class="author--portrait" src="/assets/images/bodo.jpg" alt="Portrait photo of Bodo Tasche">
    <div class="author--name">
      Bodo Tasche
    </div>
    <div class="author--role">
      Polyglot Developer
    </div>
  </div>

  <div class="author--description">
    <p>
      I am a freelance polyglot developer and love HTML5, testing, JavaScript, Ruby and Elixir. In the last 20 years I
      have been in lots of different roles, from Java to Elixir, from backend developer at a 3 people team in an early
      phase startup to the CTO of a web agency. Some of my work can be seen on my <a href="https://bodo.tasche.me/projects">projects page</a>.
    </p>
    <p>
      Need help developing your MVP or to add new features into your current app? Need a CTO or a front/backend
      developer for hire? Send me an <a href="bodo@tasche.me">email</a>.
    </p>
  </div>
</div>
<footer>
  <a href="https://github.com/bitboxer" aria-label="GitHub Profile">
    <i class="fab fa-github"></i>
  </a>
  <a href="https://twitter.com/bitboxer" aria-label="Twitter Profile">
    <i class="fab fa-twitter"></i>
  </a>
  <a href="https://speakerdeck.com/bitboxer" aria-label="Speaker Deck Profile">
    <i class="fab fa-speaker-deck" aria-hidden="true"></i>
  </a>
  <a href="https://www.linkedin.com/in/bodo-tasche-644413b8/" aria-label="Linkedin Profile">
    <i class="fab fa-linkedin"></i>
  </a>
</footer>
      </div>
    </div>
  </body>
</html>
